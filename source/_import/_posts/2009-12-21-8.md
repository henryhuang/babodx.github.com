--- 
categories: []
comments: true
layout: post
title: "ubuntu 9.04 server 安装VMware Tools解决share folders问题"
---
<pre>我的主系统是Winxp在vmware 6.5.2 build-156735下安装的ubuntu server 9.04</pre>
<pre>因为安装vmware tools后，可以使用vmware 提供的share folders让winxp的主系统可以将某个目录映射到虚拟的ubuntu系统里。</pre>
<pre>我就开始在vmware里面安装vmware tools工具。下面是过程，包括不能用vmhgfs的解决办法</pre>
<pre><strong>安装VMware tools</strong></pre>
<pre><strong>安装前，先安装需要的软件包</strong></pre>
<pre>apt-get install autoconf automake binutils make cpp gcc linux-headers-$(uname -r)</pre>
<pre>安装后，在vmware上面选择VM-》Install Vmware Tools</pre>
<pre>然后切换到ubuntu server 9.04里，运行mount命令，将Vmware tools的光盘挂载</pre>
<pre><span style="color:#0000ff;">sudo mount /dev/cdrom /mnt</span></pre>拷贝安装VMware Tools需要的安装文件到/tmp目录 
<span style="color:#0000ff;">sudo cp /mnt/VMwareTools-7.8.5-156735.tar.gz /tmp</span> 
<span style="color:#000000;">卸载/mnt目录，因为安装的时候，需要在/mnt目录下创建hgfs目录，如果这时候挂载着CDROM，就会导致创建hgfs目录失败。</span> 
<span style="color:#0000ff;">sudo /mnt</span> 
<span style="color:#000000;">解压安装文件并修改会出现问题的page.c文件</span> 
<span style="color:#0000ff;">cd /tmp</span> 
<span style="color:#0000ff;">tar zxvf VMwareTools-7.8.5-156735.tar.gz </span>
<span style="color:#0000ff;">cd /tmp/vmware-tools-distrib/lib/modules/source</span> 
<span style="color:#0000ff;">sudo cp ./vmhgfs.tar /tmp/</span> 
<span style="color:#0000ff;">tar xvf vmhgfs.tar </span>
<span style="color:#0000ff;">cd vmhgfs-only/ </span>
<span style="color:#0000ff;">sudo vi page.c</span> 
<span style="color:#000000;">修改page.c里面867行的一个错误函数，</span> 
<span style="color:#0000ff;">page = __grab_cache_page(mapping, index); </span>
将这个函数修改为 
<span style="color:#0000ff;">page = grab_cache_page_write_begin(mapping, index,flags);</span> 
<span style="color:#000000;">这个函数是在/usr/src/linux-headers-2.6.28-11-server/include/linux$下的，pagemap.h里面定义的，内容如下</span> 
struct page *grab_cache_page_write_begin(struct address_space *mapping,<br>
                        pgoff_t index, unsigned flags); 
修改后，保存。然后重新打包成vmhgfs.tar文件，放置到/tmp/vmware-tools-distrib/lib/modules/source目录下。
完成上面工作后，就可以
<span style="color:#0000ff;">cd /tmp/vmware-tools-distrib</span>
<span style="color:#0000ff;">sudo ./vmware-install.pl</span>
安装提示安装就可以了。 
当看到如下提示，代表已经正确编译了vmhgfs模块了。应该可以顺利使用share folders功能。 
<span style="color:#ff0000;">The vmhgfs module loads perfectly into the running kernel.</span> 
也可以运行
lsmod |grep vmhgfs
如果有如下显示，表示安装成功
<span style="color:#ff0000;">vmhgfs                 53728  1</span> 
<span style="color:#000000;">这样就可以用vmware提供的share folders功能和ubuntu server 9.04共享文件了。</span><div id="related_log" style="font-size:12px">
<b>相关日志：</b><a href="http://xinlogs.com/post/7">ubuntu server 9.04显示中文文件</a><a href="http://xinlogs.com/post/2">CentOS虚拟化服务的配置</a><a href="http://xinlogs.com/post/20">ubuntu下arp攻击防御和反击！</a><a href="http://xinlogs.com/post/5">ubuntu 9.04安装xen</a><a href="http://xinlogs.com/post/12">CentOS 5.3下成功安装了Xen虚拟化服务。</a>
</div>
