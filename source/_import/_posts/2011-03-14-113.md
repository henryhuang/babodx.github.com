--- 
categories: []
comments: true
layout: post
title: mysqldump解决中文乱码问题
---
我的数据库采用编码如下：
mysql> show variables like 'coll%';<br>
+----------------------+-------------------+<br>
| Variable_name        | Value             |<br>
+----------------------+-------------------+<br>
| collation_connection | latin1_swedish_ci |<br>
| collation_database   | latin1_swedish_ci |<br>
| collation_server     | latin1_swedish_ci |<br>
+----------------------+-------------------+<br>
3 rows in set (0.00 sec)<br>
 
mysql> show variables like 'character_set%';<br>
+--------------------------+----------------------------+<br>
| Variable_name            | Value                      |<br>
+--------------------------+----------------------------+<br>
| character_set_client     | latin1                     |<br>
| character_set_connection | latin1                     |<br>
| character_set_database   | latin1                     |<br>
| character_set_filesystem | binary                     |<br>
| character_set_results    | latin1                     |<br>
| character_set_server     | latin1                     |<br>
| character_set_system     | utf8                       |<br>
| character_sets_dir       | /usr/share/mysql/charsets/ |<br>
+--------------------------+----------------------------+<br>
8 rows in set (0.00 sec)<br>
 
数据库的编码采用utf8
开始用mysqldump出来的都是乱码。后来采用 --default-character-set=gbk参数，然后再用iconv转码为utf8就解决了问题。
下面是我的数据库备份脚本
<div class="codeText">
<span class="copyCodeText" onclick="copyIdText('code_8985');" style="cursor:pointer;">复制内容到剪贴板</span> <div id="code_8985">
<ol class="dp-cpp" style="border-bottom:0px;border-left:0px;list-style-type:none;margin-left:5px;border-top:0px;border-right:0px;">
<li class="alt"><span><span class="preprocessor">#!/bin/sh </span><span>  </span></span></li>
    <li>
<span class="preprocessor">#####configurate####### </span><span>  </span>
</li>
    <li class="alt"><span>rq=`date +%Y%m%d%N`   </span></li>
    <li>
<span>user=</span><span class="string">"user"</span><span>  </span>
</li>
    <li class="alt">
<span>password=</span><span class="string">"password"</span><span>  </span>
</li>
    <li><span>rm -rf /var/lib/mysql/mysql-bin.*   </span></li>
    <li class="alt">
<span>mysqldump -u$user -p$password --</span><span class="keyword">default</span><span>-character-set=gbk --single-transaction --flush-logs --master-data=2 mydatabase>/home/ict/mysql_backup/database$rq.sql   </span>
</li>
</ol>
</div>
<link rel="stylesheet" type="text/css" href="http://www.xinlogs.com/editor/fckeditor/editor/plugins/insertcode/insertcode.css">
<script language="javascript" src="http://www.xinlogs.com/editor/fckeditor/editor/plugins/insertcode/excute.js" type="text/javascript"></script>
</div>
导出后转码
iconv -t utf-8 -f gbk -c database.sql>databaseutf8.sql
这样已经可以看到正确的中文了。
导入
在windows下，如果采用HeidiSQL打开SQL文件，可以正确看到中文，但是导入后还是乱码。
解决办法，采用记事本打开，选择另存为，编码选择ANSI。然后再用HeidiSQL工具打开导入即可。<div id="related_log" style="font-size:12px">
<b>相关日志：</b><a href="http://xinlogs.com/post/9">ubuntu server 9.04 终端乱码问题</a><a href="http://xinlogs.com/ruby_import_dbf_to_mysql">ruby将DBF文件导入MYSQL库</a><a href="http://xinlogs.com/post/22">一个在windows下很好用的MySQL工具Navicat</a><a href="http://xinlogs.com/HeidiSQL">HeidiSQL一款开源的MySQL图形管理软件</a><a href="http://xinlogs.com/mysql-error-index-is-slower">Mysql错误索引比没索引还慢</a>
</div>
