--- 
categories: []
comments: true
layout: post
title: rails下上传文件并且解决乱码问题
---
<div id="msgcns!4986F8F322CC617B!220" class="bvMsg">这个问题是我在<a href="http://www.javaeye.com/">www.javaeye.com</a>论坛上提出的，并且由mathsfan给出了解决办法首先创建一个项目，叫<strong>test</strong>在app目录下的controllers目录下，找到<strong>test_controller.rb</strong>文件添加一个upload的actiondef uploadend然后在view目录下的test目录下，创建一个<strong>upload.rhtml</strong>文件<%=form_tag({:action=>'save'},:multipart=>true)%><br><br/><br>upload your file:<%=file_field("file","file")%><br><br/><br><%=submit_tag("upload")%><br><%=end_form_tag%><br>现在访问<a href="http://localhost:3000/test/upload">http://localhost:3000/test/upload</a>，应该可以看到一个上传的界面了。不过还没有处理上传后的方法呢，所以还不能实现上传。因为上面的表单是提交给save这个action 的，现在还没有写呢。在写save之前，先要完成一些相关的方法在<strong>application.rb</strong>文件里，加入def uploadFile(file) #处理上传后的文件保存<br>       if !file.original_filename.empty? <br>         #生成一个随机的文件名 <br>         @filename=getFileName(file.original_filename) <br>         #向dir目录写入文件 <br>         File.open("#{RAILS_ROOT}/public/images/#{@filename}", "wb") do |f| <br>           f.write(file.read) <br>         end <br>         #返回文件名称<br>         return @filename <br>       end <br>end <br><br>def getFileName(filename) #获取文件名<br>       if !filename.nil? <br>         return filename <br>       end <br>end 现在在<strong>test_controller.rb</strong>里写出save的actiondef save <br>       unless request.get? <br>         if filename=uploadFile(params[:file]['file']) #调用<strong>application.rb</strong>里写的uploadFile对文件保存<br>           render :text=>filename <br>         end <br>       end <br>end 文件可以正确上传到public/images下 <br>但是中文文件名变为了乱码,但是render :text=>filename返回的名字,并不是乱码. <strong>解决办法</strong>在ApplicationController加上： <br>before_filter:set_charset <br>def set_charset <br>      @headers["Content-Type"]="text/html;charset=gb2312" <br>end <br>我试验了一下，用utf8也可以正常处理,比如按照如下写法 <br>def set_charset <br>       @headers["Content-Type"]="text/html;charset=utf8" <br>end </div>
<div class="footerLinks">2007/4/18 10:16 </div>
