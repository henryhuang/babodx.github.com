--- 
categories: []
comments: true
layout: post
title: ubuntu下arp攻击防御和反击！
---
今天在单位，发现有人在用聚生网管和p2p终结者<br>
在windows下面，可以安装arp防火墙，还可以通过安装同类软件，进行检测。可是我已经转到ubuntu上了，总不能一旦被攻击，就回windows吧。于是上网找了一些关于linux下防止arp攻击的方法。<br><strong>第一种方法</strong><br>
用静态arp.<br>
这种方法就是通过在 /etc/ethers 建立ip和mac地址对应记录。然后用arp -f来读取记录。这样将网关的mac地址和ip都建立在静态arp文件里。就不容易被arp欺骗了。<br>
还可以配合关闭arp解析，用ifconfig eth0 -arp<br><strong><br>
第二中方法</strong><br>
采用arping <br>
babo@babo-laptop:~$ arping <br>
Usage: arping [-fqbDUAV] [-c count] [-w timeout] [-I device] [-s source] destination<br>
-f : quit on first reply<br>
-q : be quiet<br>
-b : keep broadcasting, don't go unicast<br>
-D : duplicate address detection mode<br>
-U : Unsolicited ARP mode, update your neighbours<br>
-A : ARP answer mode, update your neighbours<br>
-V : print version and exit<br>
-c count : how many packets to send<br>
-w timeout : how long to wait for a reply<br>
-I device : which ethernet device to use (eth0)<br>
-s source : source ip address<br>
destination : ask for what ip address<br><br>
用法举例：比如我的ip 192.168.1.101 网关:192.168.1.1<br>
就用arping -U -I eth0 -s 192.168.1.101 192.168.1.1<br>
显示结果如下<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.999ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 9.571ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.245ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.227ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.390ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 4.526ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.294ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.245ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.239ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.266ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.259ms<br>
Unicast reply from 192.168.1.1 [00:21:29:94:62:47] 1.267ms<br>
Sent 12 probes (1 broadcast(s))<br>
Received 12 response(s)<br><br><strong>终极解决办法</strong><br>
采用arpoison来解决是最好的办法了，这个办法还是参考了《linux下arp攻击的解决方案［原］》的办法。<br>
arpoison需要libnet的库才能正确编译，所以要下载libnet和arpoison两个软件。<br><br><strong>arpoison主页</strong><br><a href="http://www.packetfactory.net/libnet">http://www.arpoison.net/</a><br><br><strong>libnet主页</strong><br><a href="http://www.packetfactory.net/libnet">http://www.packetfactory.net/libnet</a><br><br><strong>安装</strong><br>
现安装libnet,因为是源代码编译，需要gcc等我就不说了。去查看具体ubuntu源代码安装需要的软件包吧<br>
tar zxvf libnet.tar.gz<br>
cd libnet/<br>
sudo ./configure<br>
sudo make<br>
sudo make install<br>
编译过程中，会提示也些警告，没有关系。反正安装后，有/usr/lib/libnet.a就可以了<br><br>
然后安装arpoison<br>
tar zxvf arpoison-0.6.tar.gz <br>
cd arpoison/<br>
sudo gcc arpoison.c /usr/lib/libnet.a -o arpoison<br>
sudo mv arpoison /usr/sbin<br><span style="color:#00aa00;"><em><strong><br></strong></em></span>用法举例：<br>
babo@babo-laptop:~$ sudo arpoison<br>
Usage: -i <device> -d <dest IP> -s <src IP> -t <target MAC> -r <src MAC> [-a] [-w time between packets] [-n number to send]<br><br>
说明<br>
-i 指定发送arp包的网卡接口eth0<br>
-d 192.168.1.1 指定目的ip为192.168.1.1<br>
-s 192.168.1.101 指定源ip为192.168.1.101<br>
-t ff:ff:ff:ff:ff:ff 指定目的mac地址为ff:ff:ff:ff:ff:ff(arp广播地址)<br>
-r 00:1c:bf:03:9f:c7 指定源mac地址为00:1c:bf:03:9f:c7<br><br>
比如我想防止arp攻击<br>
sudo arpoison -i eth0 -d 192.168.1.1 -s 192.168.1.101 -t ff:ff:ff:ff:ff:ff -r 00:1c:bf:03:9f:c7<br><br>
比如我想攻击192.168.1.50的机器不让他上网<br>
sudo arpoison -i eth0 -d 192.168.1.50 -s 192.168.1.1 -t ff:ff:ff:ff:ff:ff -r 00:1c:bf:03:9f:c7<br><br><strong>一些猜想</strong><br>
如果在本机开始NAT服务<br>
然后通过arp欺骗把对方的网关地址欺骗到自己这里，因为自己这里开了NAT，对方应该也可以上网吧。然后在本地开wireshark抓包，对方就不知不觉的被监视了。这些想法没有测试，不知道这样欺骗的办法，NAT是否可以。<div id="related_log" style="font-size:12px">
<b>相关日志：</b><a href="http://xinlogs.com/centos-install-ruby-rubygems">centos 源码安装ruby和rubygems</a><a href="http://xinlogs.com/monit-to-monitor-services">monit监控linux服务</a><a href="http://xinlogs.com/post/17">如何快速统计服务器访问量</a><a href="http://xinlogs.com/OpenVPN-Install">CentOS 5.3下OpenVPN安装和Win7下OpenVPN GUI安装</a><a href="http://xinlogs.com/post/15">试用ubuntu 8.04和LVM动态增加分区</a>
</div>
