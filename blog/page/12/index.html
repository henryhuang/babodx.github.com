
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>鑫的方向</title>
  <meta name="author" content="babodx">

  
  <meta name="description" content="今天发现了http://www.igniterealtime.org这个项目首页 这个项目可以在企业内部架设一台服务器，来完成内部IM功能。客户端可以想QQ或者MSN一样登陆。并且通过服务器上设置GATEWAY功能，还能与MSN等主流软件通讯。 具体功能还没有测试， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://babodx.github.com/blog/page/12/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="鑫的方向" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">鑫的方向</a></h1>
  
    <h2>简单就是不简单！</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:babodx.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/opensource-im/">一个很好的开源企业内部IM解决方案</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/opensource-im/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天发现了<a href="http://www.igniterealtime.org/">http://www.igniterealtime.org</a>这个项目首页</p>

<p>这个项目可以在企业内部架设一台服务器，来完成内部IM功能。客户端可以想QQ或者MSN一样登陆。并且通过服务器上设置GATEWAY功能，还能与MSN等主流软件通讯。</p>

<p>具体功能还没有测试，不过打算有时间的时候架设下进行试用。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/navicat/">一个在windows下很好用的MySQL工具Navicat</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/navicat/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>为了解决中文乱码，我的Mysql都设置了使用utf8编码</p>

<p>这样一来，使用SQLyog Enterprise查看表里面内容，就都不能正常显示了。可能SQLyog需要设置？反正我没有搞出来。</p>

<p>不过后来我换用了Navicat 7以后，感觉很好。所有中文内容都可以正确显示</p>

<p>比mysql front也要强很多。以后我就用这个了
<img src="http://www.navicat.com/images/stories/product/mysql/product/win/win_big.jpg" alt="navicat" /></p>

<p>而且支持Linux,windows,mac三个平台。下面是介绍</p>

<p><span>PremiumSoft Navicat™ is a powerful MySQL database administration and development tool that is not only sophisticated enough for professional developers, but also easy to learn for new users. With an user-friendly GUI, Navicat™ lets you quickly and easily create, organize, access and share information in a secure and convenient way. </span>
<span>PremiumSoft Navicat supports multiple MySQL server connections which can be connected locally or remotely. Your remote MySQL server can be running on Linux, Unix, Mac OS X or Windows platform.<br></span></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/mysql-log-sql/">Mysql设置my.cnf来记录下全部sql请求</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/mysql-log-sql/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>要想记录下提交到mysql数据库的全部sql语句，可以通过修改my.cnf来实现</p>

<p>修改/etc/my.cnf文件</p>

<p>找到[mysqld]段
加入</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>log=queryLog
</span><span class='line'>log-slow-queries=showquerylog</span></code></pre></td></tr></table></div></figure>


<p>然后就可以到/var/lib/mysql/目录下找到queryLog和showquerylog日志文件了</p>

<p>里面记录这每个提交到数据库执行的sql语句。</p>

<p>我的系统CentOS 4.4 rpm方式安装的mysql 5.0.57,如果其它系统或者其它安装方式，可能文件路径会有些不同。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/mysql-import/">如何向万网的Mysql数据库导入数据</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/mysql-import/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>昨天单位由一个网站，要放到万网的虚拟主机去。
网站是jsp写的，程序好导。直接ftp过去就可以了。</p>

<p>可是mysql的数据库怎么导呢？</p>

<p>我先用</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysqldump database_name&gt;database_name.sql</span></code></pre></td></tr></table></div></figure>


<p>然后把这个database_name.sql下载下来。</p>

<p>再给虚拟主机空间上传一个phpmyadmin来做数据库管理用。这样就可以使用phpmyadmin导入数据了。</p>

<p>如果网站数据小，这样就ok了。可是我的database_name.sql有60M</p>

<p>万网空间上的phpmyadmin只能最大支持2M</p>

<p>于是只能另外想办法。我先导入表格结构吧。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysqldump –d database_name&gt;database_name.sql</span></code></pre></td></tr></table></div></figure>


<p>在phpmyadmin里，选择好数据库后，用导入功能，将database_name.sql导入</p>

<p><img src="http://farm9.staticflickr.com/8096/8510015688_bc8709cc96.jpg" alt="phpmyadmin图片" /></p>

<p>现在有了表结构了，但是每个表都没有数据。我们再继续导入数据。</p>

<p>我的表里面，除了一个news表格特别大，大约51M，其他都在2M一下。所以我每个表格生成一个txt文件，然后导入到万网的数据库。</p>

<p>本地进入mysql>提示符后，用以下命令将数据的表格数据导出。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select * from admin into outfile “/tmp/admin.txt” fields terminated by “|” lines terminated by “@”</span></code></pre></td></tr></table></div></figure>


<p>上面命令将本地数据库的admin表，导出到/tmp/目录下的admin.txt文件。</p>

<p>我们有几个表格，就用这个命令导出几个txt文件。</p>

<p>然后将txt文件用gzip压缩，因为phpmyadmin支持gzip压缩格式的。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /tmp/
</span><span class='line'>gzip admin.txt</span></code></pre></td></tr></table></div></figure>


<p>最后将压缩的admin.txt.gz下载到本地，用浏览器上传给phpmyadmin导入</p>

<p>![](</p>

<p><strong>解决news表格过大问题</strong></p>

<p>我的news表格有51Ｍ，就算gzip压缩后，还有7M左右，还是不能用phpmyadmin导入。我们可以将news表格的数据切分为多个txt文件，然后保证每个文件gzip后，在2M以内就可以。这个切分就要根据具体表格来判断了。</p>

<p>我先查询了news表格一共有多少条记录</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select count(*) from news;</span></code></pre></td></tr></table></div></figure>


<p>返回1477条，表格是51M。压缩后的表格是7M。</p>

<p>7M/2M=3.5</p>

<p>1477/3.5=422条。</p>

<p>根据上面的计算，只要按照422条一个文件来分割就可以了。为了保险，因为每条记录的大小并不是一样的平均分配，我按照每个文件200条记录来切分。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select * from news where newId&gt;0 limit 200 into outfile “/tmp/news0.txt” fields terminated by “|” lines terminated by “@”;
</span><span class='line'>
</span><span class='line'>然后用
</span></code></pre></td></tr></table></div></figure>


<p>select max(newId) from news where newId>0 limit 200;
&#8220;`</p>

<p>查看下200条记录后，是到了那条记录，下次分割就从那条开始
这样分割出来的8个文件，一次压缩后，上传到phpmyadmin导入。就完成了全部表格的导入工作。</p>

<p><strong>总结</strong></p>

<p>其实如果数据本身不复杂，直接用navicat也可以远程连接导入的。但是navicat不支持定义 lines terminated。我的news表格里面存在的都是html代码，经常出现换行符，所以只能选择用phpmyadmin了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/mage-recover/">我的高督法师的装备恢复了</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/mage-recover/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天恢复了高督法师的装备，虽然损失了3500G，但是装备还是给恢复回来了现在装备没有FM了，只有440法伤。。。。以前523知足了。希望大家都用密保卡，省的丢号</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/mage-be-stolen/">我的高督被盗了&#8230;&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/mage-be-stolen/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>07年3月29日,我的高督法式被盗了,同一个账号下还有60的萨满.因为是朋友玩的时候被盗的，我到是没有什么感觉。反正也冲到高督了，该玩的也玩了。ZG鳄鱼,MLD公主也刷了。现在也是该离开的时候了</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/mage/">我冲高督的心得</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/mage/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>我在2006年6月就开始冲高督了,然是玩的号是梦之盗帅. 亡灵盗贼(哈哈)</p>

<p>开始也是一个人到处混,涨得很慢.一周也就10w荣誉,后来通过傻鸟介绍,认识了一个固定队伍.</p>

<p>固定队伍就是不一样,都是有人带队而且有LM的固定队伍可以一起刷荣誉.在遇到不认识的队伍的时候,才会打. 这里要说一下,有很多人认为刷子不好,可是在我们这里,如果你不刷,真打的荣誉也就够你升到10级勇士的.刷也是很辛苦的,首先加入固定队伍的人,作队长才可以晚上挂机,但是队长每周至少有72小时在线带队.如果不做队长,就要负责拿旗子.拿一天旗子,晚上可以挂一下.基本队里没有不干活的.</p>

<p>我加入后不久就做了队长&#8230;.其实队长很累&#8230;因为同时刷的有2-3个队伍,你要负责记住对不同队伍的输赢.只有这样,才能稳定的刷下去.
基本这样带队,晚上可以挂着,一周可以有70-100w荣誉.因为每个星期只有2-3人可以到14级高阶督军,所以基本都是让已经到13级督军的朋友拿1-3名,然后按照目前的军衔来分配小队里其他人的排名.这样就为了大家都能用最短时间毕业.</p>

<p>就这样我跟这个队伍混到了11级,认识了很多朋友,轻舞,心之全泪,天地有雪,正义与邪恶等&#8230;.
11级的时候已经8月初了,因为一直游戏,感觉对不起老婆(陪老婆时间太少).我最终选择了离开.</p>

<p>一直到1.12跨服战场开放,我才回来.
这次回来还是打算冲高督,但是跨服后60级战场基本都是真打了,我没有了固定队伍,就一个人很难冲上去.而50-59的这个阶段还是在刷.于是我选择了放弃梦之盗帅这个角色,用我的50法师,梦之亡魂刷
跨服战场的开放,让一个人排队刷战场成为可能.</p>

<p>开始的时候,我用BFA插件配合我自己用VC写的一个小程序刷战场,基本是每个星期哪里双倍荣誉,我就刷哪里.就一个人排队.这样效率很高,</p>

<ul>
<li>第1周,拿了36W荣誉(没有24小时刷),从侦察兵一下升了4级.而且ALX毕业了</li>
<li>第2周也差不多,升到了6级.因为ALX毕业了,一旦荣誉到30W,我就去挂大战场.在这个星期我大战场也毕业了</li>
<li>第3周,荣誉到30W我就去挂战歌,这个星期我升到了7级(开始可以买勇士装备了)</li>
<li>第4周.我顺利的升级到了8级</li>
<li>第5周,倒霉的星期.9C开始封BFA,并开通了举报系统.我被停封了3小时.不过还是升到了9级.但我开始不太敢挂了</li>
<li>第6周,BFA是不敢用了.我开始开发自己的插件了.</li>
</ul>


<p>原来配合BFA的小程序,用VC写的,模拟的都是键盘,这样可以把界面隐藏到后台,这要发送按键消息,就能正常刷战场.
现在BFA不能用了,为了不让其他人举报,我从写了那个小程序,通过对屏幕上颜色的判断来获取人物状态和是否进入战场,来采取不同的行为.我可以在3个主城的战场军官那里挂.这样可以很大程度的避免被玩家举报.就这样,我顺利的到了10级(终于勇士了)</p>

<ul>
<li>第7周,我再次被玩家举报,因为我荣誉高,其他玩家总会想办法让我停下来.不过正好我在屏幕前看着,回答了GM的问话,逃过了这次.这个星期顺利到11级(买下了全部的中将坐骑)</li>
<li>第8周,因为要准备冲14级高督,目前这样挂着,荣誉肯定不够,而且还怕被玩家举报,而我每天要上班,不可能一直人都看着.我又开始想办法了.我开始学习LUA语言,以寻求解决的办法.要是没有这段时间的努力,我不可能后面冲到高督.我居然写了一个可以自动回答GM问题的插件,而且在不知道如何回答的时候,就随面应付一句,然后下线(这样就安全多了.哈哈).所有玩家和我的对话还有GM的问题也多被记录下来.我每天下班,只要看一眼就可以了.这个星期因为一直写回答问题的插件,荣誉少了点,最终11级96%</li>
<li>第9周,新的问题来了,家里的网络开始不稳定了,总是掉线.而我对这个问题没有任何办法&#8230;.最后这个星期我之排名第7升级到了12级53%</li>
<li>第10周,我再次改写了我的程序,让程序判断是否掉线了,一旦掉线,就发出提示声音.这样就可以在最短时间发现掉线了.这个星期顺利到了13级</li>
<li>第11周.因为插件已经开始正常工作了,而且完美的回答了几次问题.让我可以放心的24小时挂了.这个星期我冲了135w荣誉</li>
<li>第12周,稳定的挂了一个排名第一,同时战歌毕业了</li>
<li>第13周,排名第2,13级94%</li>
<li>第14周,排名第一,终于14级毕业了</li>
</ul>


<p>这次刷高督,一直停留在59级.直到高督毕业,才升的60级.一共用了14周时间.哈哈
期间学习了VC和LUA语言,感觉收获比较大.不过就算我这样一直用程序刷,感觉还是比较累的.要是真打,我肯定不能到14级.</p>

<p><img src="http://farm9.staticflickr.com/8227/8510231110_d95612e0fd_z.jpg" alt="高督法师" />
现在工作比较忙,很少玩了.所以写下这篇文章留作纪念</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/install-xen-shell/">安装和使用xen-shell</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/install-xen-shell/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>转自：<a href="http://www.xen-tools.org/software/xen-shell/install.html">http://www.xen-tools.org/software/xen-shell/install.html</a></p>

<p>Installing &amp; using the Xen-Shell</p>

<p>This shell makes several assumptions in the way that it operates:</p>

<ul>
<li>That you have a Xen 3.x host running.</li>
<li>Then Xen host has several guests running.</li>
<li>That you don&#8217;t wish to give your users shell access on the host.</li>
</ul>


<p>If these assumptions are not valid for your environment then you might find that you have problems.</p>

<p><strong>Installation</strong></p>

<p>Download either <a href="http://www.xen-tools.org/releases.html">a release</a>, or a current version of <a href="http://www.xen-tools.org/cvs.html">the CVS repository</a> and install it by executing:</p>

<p><code>make install</code></p>

<p><strong>Configuring Users</strong></p>

<p>Each user is expected to login directly to the xen-shell, and not have any other access to the host system. To do this change their login shell by running:</p>

<p><code>chsh -s /usr/local/bin/xen-login-shell username</code></p>

<p>This will ensure when they connect to the system they will login to the shell, and run it within GNU Screen.</p>

<p><strong>Note:</strong>CVS and Debian binary packages use /usr/bin instead of /usr/local/.
Once you&#8217;ve changed the shell for the user you must update your Xen configuration files so that they include the username(s) of the users who can control them.
To allow the user &#8220;bob&#8221; and the user &#8220;steve&#8221; to control the Xen guest &#8220;builder.my.flat&#8221; you would add the following to /etc/xen/builder.my.flat.cfg:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># All instances must have a name name = 'builder.my.flat'     
</span><span class='line'># These users may control this instance. xen_shell = 'bob, steve' </span></code></pre></td></tr></table></div></figure>


<p><strong>Bandwidth Accounting</strong></p>

<p>The shell allows the user to view the bandwidth they have transferred over a given period, using the bandwidth command.
For this to work the vnstat tool must be installed and configured upon dom0. It is assumed that each Xen guest will have their network interface named the same as the guest name.
For example a Xen guest called &#8216;skx&#8217; will have a network interface &#8216;skx&#8217; upon dom0. If you&#8217;re using the standard Xen configuration setup you can achieve this by changing your skx.cfg file to read:</p>

<p><code>vif = [ 'vifname=skx,ip=1.2.3.4' ]</code></p>

<p><strong>Note:</strong> if you have more than one IP address allocated to a guest you will have to create a more complicated setup.</p>

<p><strong>Security</strong></p>

<p>Since the xen administrator command xm requires root privileges to run you will need to configure sudo to allow the users who are running your shell to execute that command, without being prompted for a password, as root.
Add something similar to the following to your /etc/sudoers file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User_Alias   XENUSERS = steve,bob,fred,foo 
</span><span class='line'>Cmnd_Alias   XEN      = /usr/sbin/xm 
</span><span class='line'>Cmnd_Alias   XENIMG   = /usr/bin/xen-create-image 
</span><span class='line'>XENUSERS     ALL      = NOPASSWD: XEN,XENIMG </span></code></pre></td></tr></table></div></figure>


<p><strong>Note:</strong>you only need to grant the ability to run xen-create-image if you wish to enable reimaging support in the shell.</p>

<p><strong>DNS Updates</strong></p>

<p>When the shell starts it will look for the file ips.txt in the home directory of the user who connects. If that file doesn&#8217;t exist then the rdns command will be disabled.</p>

<p>If you wish to allow users to control their reverse DNS create that file and give it contents such as these:</p>

<p><code>192.168.1.1 foo.my.domain 192.168.1.2 bar.my.domain</code></p>

<p>This file will be updated by the user when they invoke the rdns command. It is up to you to read the files and create the corresponding zonefiles / DNS updates. The shell will only manipulate the file - not push DNS updates itself.</p>

<p><strong>Reimaging Support</strong></p>

<p>If a user connects to the shell and has the executable file image.sh in their home directory the reimage command will be enabled.
When the user invokes the command the image.sh script is executed after prompting for confirmation, and performing a last-chance count-down.
It is up to you to create and configure this script to do the right thing. A sample file for user bob could look like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh /usr/bin/xen-create-image --hostname=bob \  
</span><span class='line'>--ip=192.168.1.1  \  
</span><span class='line'>--ip=192.168.1.2 \  
</span><span class='line'>--size=9.5G \  
</span><span class='line'>--swap=512M  --mem=256M \  
</span><span class='line'>--force </span></code></pre></td></tr></table></div></figure>


<p>This will require a correctly configured instance of <a href="http://www.xen-tools.org/software/xen-tools/">xen-tools</a> and the sudoer file to contain the ability for the user to run xen-create-image.</p>

<p>Any remaining questions? <a href="http://www.xen-tools.org/contact/">contact the author</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/howto-mount-xen-img/">怎么mount一个xen的img映像。转载</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/howto-mount-xen-img/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li>First you need to find out the partitions and the startsector of partitions:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@xen rruban]# file rheltest.img rheltest.img: x86 boot sector, GRand Unified Bootloader (0.94); 
</span><span class='line'>partition 
</span><span class='line'>1: ID=0x83, active, starthead 1, startsector 63, 208782 sectors; partition 
</span><span class='line'>2: ID=0x8e, starthead 0, startsector 208845, 3871665 sectors, code offset 0x48</span></code></pre></td></tr></table></div></figure>


<p>There are 3 partitions inside the image file. The startsector of each partition is also listed. Boot partition will have start sector 63.</p>

<ul>
<li>Now you need to get the sector size:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@xen]fdisk -lu rheltest.img
</span><span class='line'>Disk rheltest.img: 0 MB, 0 bytes 255 heads, 63 sectors/track, 0 cylinders, total 0 sectors 
</span><span class='line'>Units = sectors of 1 * 512 = 512 bytes 
</span><span class='line'>Device Boot Start End Blocks Id System 
</span><span class='line'>rheltest.img1 * 63 208844 104391 83 Linux 
</span><span class='line'>rheltest.img2 208845 4080509 1935832+ 8e Linux LVM </span></code></pre></td></tr></table></div></figure>


<p>The above shows the sector byte size is 512 byte.</p>

<ul>
<li>To calculating the offset: offset = start_sector x sector_byte_size.</li>
</ul>


<p>The startsector is 63 for the first partition, therefore the first partition offset is: 63x512=32256</p>

<ul>
<li>Finally, to mount the xen image, use:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -o loop,offset=32256 test.img /foldername</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/howto-create-foreign-key-on-mysql/">如何建立两个表间的外键</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/12/21/howto-create-foreign-key-on-mysql/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>建立Mysql两个表间的外键,需要满足三个条件</p>

<ol>
<li>两个表必须是InnoDB表类型</li>
<li>使用在外键关系的域必须为索引型(Index)</li>
<li>使用在外键关系的域必须与数据类型相似</li>
</ol>


<p>下面举例说明</p>

<p>我们创建一个班级表和一个学生表,并建立一个外键</p>

<p>创建班级表</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE TABLE class (id INT NOT NULL AUTO_INCREMENT, classname VARCHAR(50) NOT NULL, PRIMARY KEY(id)) ENGINE=INNODB;</span></code></pre></td></tr></table></div></figure>


<p>插入班级数据</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>INSERT INTO class VALUES (1,"一班"),(2,"二班"),(3,"三班");</span></code></pre></td></tr></table></div></figure>


<p>创建学生表</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE TABLE students (id INT(4) NOT NULL, name VARCHAR(50) NOT NULL, FK_class INT(4) NOT NULL, INDEX (FK_class), FOREIGN KEY (FK_class) REFERENCES class (id), PRIMARY KEY(id)) ENGINE=INNODB;</span></code></pre></td></tr></table></div></figure>


<p>验证外键约束性,我们向students表插入一个学生数据,并让FK_class的值为一个在class表里面不存在的值.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; INSERT INTO students VALUES (1,"zhang",5);</span></code></pre></td></tr></table></div></figure>


<p>马上就会看到Mysql报错</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ERROR 1452 : Cannot add or update a child row: a foreign key constraint fails (`test/students`, CONSTRAINT `students_ibfk_1` FOREIGN KEY (`FK_class`) REFERENCES `class` (`id`))</span></code></pre></td></tr></table></div></figure>


<p>以上证明外键可以正常工作了</p>

<p>在Mysql下测试了以下,不建立index,并且不指定innodb格式.
版本</p>

<p>+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+
| version()            |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+
| 5.0.24a-community-nt |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+</p>

<p>建立class表</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE TABLE class (id INT NOT NULL AUTO_INCREMENT, classname VARCHAR(50) NOT NULL, PRIMARY KEY(id));</span></code></pre></td></tr></table></div></figure>


<p>建立students表</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE TABLE students (id INT(4) NOT NULL, name VARCHAR(50) NOT NULL, FK_class INT(4) NOT NULL, FOREIGN KEY (FK_class) REFERENCES class (id), PRIMARY KEY(id));</span></code></pre></td></tr></table></div></figure>


<p>通过Navicat查看,上面语句建立的两个表,也会默认用INNODB存储,而且也在students表建立了index和外键.一切正常.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/13/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/11/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
<h1>Categories</h1>
<ul id="categories">
  <li class='category'><a href='/blog/categories/css/'>CSS (2)</a></li>
<li class='category'><a href='/blog/categories/cloudstack/'>Cloudstack (1)</a></li>
<li class='category'><a href='/blog/categories/database/'>Database (10)</a></li>
<li class='category'><a href='/blog/categories/game/'>Game (15)</a></li>
<li class='category'><a href='/blog/categories/hardware/'>Hardware (9)</a></li>
<li class='category'><a href='/blog/categories/host/'>Host (3)</a></li>
<li class='category'><a href='/blog/categories/java/'>Java (3)</a></li>
<li class='category'><a href='/blog/categories/life/'>Life (3)</a></li>
<li class='category'><a href='/blog/categories/linux/'>Linux (50)</a></li>
<li class='category'><a href='/blog/categories/mac/'>Mac (5)</a></li>
<li class='category'><a href='/blog/categories/mobile/'>Mobile (8)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>Octopress (2)</a></li>
<li class='category'><a href='/blog/categories/php/'>PHP (14)</a></li>
<li class='category'><a href='/blog/categories/plan/'>Plan (1)</a></li>
<li class='category'><a href='/blog/categories/rails/'>Rails (5)</a></li>
<li class='category'><a href='/blog/categories/ruby/'>Ruby (2)</a></li>
<li class='category'><a href='/blog/categories/software/'>Software (7)</a></li>
<li class='category'><a href='/blog/categories/vim/'>Vim (1)</a></li>
<li class='category'><a href='/blog/categories/virtualization/'>Virtualization (9)</a></li>
<li class='category'><a href='/blog/categories/website/'>Website (4)</a></li>
<li class='category'><a href='/blog/categories/windows/'>Windows (10)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (1)</a></li>
<li class='category'><a href='/blog/categories/vim/'>vim (1)</a></li>

</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/03/03/kuai-su-pei-zhi-vimhe-macvim/">快速配置vim和macvim</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/28/emlogqian-yi-dao-octopress/">emlog迁移到octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/24/git-first-on-ubuntu/">git-first-on-ubuntu</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/20/wo-2013nian-xue-xi-lie-biao/">我2013年学习列表</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/13/kai-shi-shi-yong-octopress/">开始使用octopress</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - babodx -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'xinlogs';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
