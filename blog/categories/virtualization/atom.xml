<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Virtualization | 鑫的方向]]></title>
  <link href="http://babodx.github.com/blog/categories/virtualization/atom.xml" rel="self"/>
  <link href="http://babodx.github.com/"/>
  <updated>2013-02-27T00:26:05+08:00</updated>
  <id>http://babodx.github.com/</id>
  <author>
    <name><![CDATA[babodx]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[怎么mount一个xen的img映像。转载]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/howto-mount-xen-img/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/howto-mount-xen-img</id>
    <content type="html"><![CDATA[<ul>
<li>First you need to find out the partitions and the startsector of partitions:</li>
</ul>


<p><code>
[root@xen rruban]# file rheltest.img rheltest.img: x86 boot sector, GRand Unified Bootloader (0.94);
partition
1: ID=0x83, active, starthead 1, startsector 63, 208782 sectors; partition
2: ID=0x8e, starthead 0, startsector 208845, 3871665 sectors, code offset 0x48
</code></p>

<p>There are 3 partitions inside the image file. The startsector of each partition is also listed. Boot partition will have start sector 63.</p>

<ul>
<li>Now you need to get the sector size:</li>
</ul>


<p><code>
[root@xen]fdisk -lu rheltest.img
Disk rheltest.img: 0 MB, 0 bytes 255 heads, 63 sectors/track, 0 cylinders, total 0 sectors
Units = sectors of 1 * 512 = 512 bytes
Device Boot Start End Blocks Id System
rheltest.img1 * 63 208844 104391 83 Linux
rheltest.img2 208845 4080509 1935832+ 8e Linux LVM
</code></p>

<p>The above shows the sector byte size is 512 byte.</p>

<ul>
<li>To calculating the offset: offset = start_sector x sector_byte_size.</li>
</ul>


<p>The startsector is 63 for the first partition, therefore the first partition offset is: 63x512=32256</p>

<ul>
<li>Finally, to mount the xen image, use:</li>
</ul>


<p><code>
mount -o loop,offset=32256 test.img /foldername
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[获取XEN guestOS的images文件]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/get-xen-guestos-image/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/get-xen-guestos-image</id>
    <content type="html"><![CDATA[<p>我们可以从<a href="http://stacklet.com/">http://stacklet.com/</a>其实就是原来<a href="http://jailtime.org/">http://jailtime.org/</a>站点找我们需要的xen image文件</p>

<p>在2009年的时候，jailtime.org发布了一个新闻</p>

<h6>May 4th, 2009</h6>

<p>The jailtime project has been relaunched with a new name and site: <a href="http://stacklet.com/">Stacklet</a>
As part of the relaunch all of the distributions currently on jailtime have been upgraded to their latest versions. Also, all of the code for creating the images is now publically available – see <a href="http://stacklet.com/">http://stacklet.com/</a> for further details....
Jailtime will remain online but downloads will probably be turned off eventually as the transition to stacklet proceeds.</p>

<p>所以现在就访问<a href="http://stacklet.com/">http://stacklet.com/</a>就可以了。</p>

<p>包括如下系统</p>

<p><li>
<a href="http://stacklet.com/downloads/images/list/CentOS">CentOS</a> <ul>
<li>
<a href="http://stacklet.com/downloads/images/centos/5.3">5.3</a> </li>
<li><a href="http://stacklet.com/downloads/images/centos/5.3.64bit">5.3 (64-bit)</a></li>
</ul>
</li>
<li>
<a href="http://stacklet.com/downloads/images/list/Debian">Debian</a> <ul>
<li>
<a href="http://stacklet.com/downloads/images/debian/5.0">5.0 (Lenny)</a> </li>
<li><a href="http://stacklet.com/downloads/images/debian/5.0.64bit">5.0 (Lenny, 64-bit)</a></li>
</ul>
</li>
<li>
<a href="http://stacklet.com/downloads/images/list/Fedora">Fedora</a> <ul>
<li>
<a href="http://stacklet.com/downloads/images/fedora/10">10</a> </li>
<li><a href="http://stacklet.com/downloads/images/fedora/10.64bit">10 (64-bit)</a></li>
</ul>
</li>
<li>
<a href="http://stacklet.com/downloads/images/list/Gentoo">Gentoo</a> <ul>
<li>
<a href="http://stacklet.com/downloads/images/gentoo/2008-0">2008.0</a> </li>
<li><a href="http://stacklet.com/downloads/images/gentoo/2008-0.64bit">2008.0 (64-bit)</a></li>
</ul>
</li>
<li>
<a href="http://stacklet.com/downloads/images/list/Mandriva">Mandriva</a> <ul>
<li>
<a href="http://stacklet.com/downloads/images/mandriva/2009.0">2009.0</a> </li>
<li><a href="http://stacklet.com/downloads/images/mandriva/2009.0.64bit">2009.0 (64-bit)</a></li>
</ul>
</li>
<li>
<a href="http://stacklet.com/downloads/images/list/Slackware">Slackware</a> <ul>
<li><a href="http://stacklet.com/node/13">12.2</a></li>
</ul>
</li>
<li>
<a href="http://stacklet.com/downloads/images/list/Ubuntu">Ubuntu</a> <ul>
<li>
<a href="http://stacklet.com/downloads/images/ubuntu/9.04">9.04 (Jaunty)</a> </li>
<li><a href="http://stacklet.com/downloads/images/ubuntu/9.04.64bit">9.04 (Jaunty, 64-bit)</a></li>
</ul>
</li>
</ul></li>
<li></p>

<p><strong>下面是一个站点提供的img文件的简单说明</strong>
<strong>All files on this site are provided without guarantee or warranty. Use at your own risk.</strong>
Each download is a bzipped tarball containing an image and cfg files:</p>

<ul>
<li>a xen guest filesystem
</li>
<li>sample xen configuration files to be used with <strong>xm create</strong>
</li>
</ul>


<p>The naming convention of the download tarball is:
<strong><distribution>.<distro-version>.<created-date>.img.tar.bz2</strong>.
For example centos.5-3.x86.20090423.img.tar.bz2 contains</p>

<ul>
<li>centos.5-3.x86.img
</li>
<li>centos.5-3.x86.xen3.cfg
</li>
<li>centos.5-3.x86.xen3.pygrub.cfg（这个文件比较重要，如果用的是CentOS 5.3的虚拟化，就需要这个文件才可以启动guestOS。因为CentOS 5.3没有提供Xen-U的内核。）
</li>
</ul>


<p>All of the packages installed in the image will be the latest versions available as of the created date, which is in yyyy-mm-dd format.</p>

<h3>Prerequisites</h3>


<ol>
<li>Working installation of Xen version 3
</li>
<li>The xen daemon (xend) must be running
</li>
<li>Enough filesystem space to accomodate the uncompressed tarball (generally 1GB)
</li>
<li>Enough unallocated RAM to run the xen guest (generally 128MB)
</li>
</ol>


<h3>Default Configuration and Networking</h3>


<p>Each filesystem is configured to use dhcp. The *.xen.cfg also is also configured for dhcp. It is recommended that you first test the filesystem using dhcp if possible before attempting other networking parameters. Each download page has additional notes on networking that is appropriate for a particular distribution.
The root login is root/password. It is highly recommened that you change the root password immediately.</p>

<h3>Installation</h3>


<p>You will need to uncompress the tarball to a local directory and edit the *.xen.cfg file to point to the uncompressed image and swap file.
If all is well you will see the guest’s boot messages scrolling by.
<strong>一些HOWTO文档</strong></p>

<h3><strong>HOWTO: Filesystems</strong></h3>


<p>In the following howto’s, <image file> should be replaced with a reference to a specific .img file.</p>

<h4><strong>How do I mount an image without booting it?</strong></h4>


<ul>
<li>mkdir -p /mnt/loop
</li>
<li>mount -o loop <image file> /mnt/loop/
</li>
</ul>


<h4><strong>How do I resize an image file?</strong></h4>


<p>First, make sure that the image file is not already mounted and is not already running as a xen guest. The following commands increase an image file to 2.5GB. Backup the image before attempting this.</p>

<ul>
<li>dd if=/dev/zero of=<image file> bs=1M conv=notrunc count=1 seek=2500 
</li>
<li>losetup /dev/loop0 <image file>
</li>
<li>e2fsck -f /dev/loop0
</li>
<li>resize2fs /dev/loop0
</li>
<li>e2fsck -f /dev/loop0
</li>
<li>losetup -d /dev/loop0
</li>
</ul>


<p>You may then boot or mount the image to confirm the increased size. The e2fsck checks in this howto are not strictly necessary.</p>

<h4><strong>How do I move the contents of an img file to a regular partition?</strong></h4>


<p>Mount the img file using the above howto. Assuming the destination partition is mounted at /mnt/dest, execute the following:</p>

<ul>
<li>cp -a /mnt/loop/* /mnt/dest/
</li>
</ul>


<p>You will then be able to boot the filesystem using the partition instead of the image file, which should provide better performance. You will need to update the *.xen.cfg file to reference the partition instead of the img file (the <strong>disk</strong> parameter will need to change, see the <a href="http://www.cl.cam.ac.uk/Research/SRG/netos/xen/readmes/user/user.html">Xen Manual</a>). Also, remember to unmount partitions or img files before booting a xen guest from them!</p>

<p></li></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS里的Xen配置pygrub]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/centos-xen-pygrub/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/centos-xen-pygrub</id>
    <content type="html"><![CDATA[<p>如果用virt-install生成一台虚拟服务器
在查看配置的时候，会发现已经没有了kernel=这个配置来制定启动内核。而是用了</p>

<p><code>bootloader = '/usr/bin/pygrub'</code></p>

<p>关于这个，可以参考
<a href="http://wiki.xensource.com/xenwiki/PyGrub">http://wiki.xensource.com/xenwiki/PyGrub</a></p>

<p>CentOS 5.3的虚拟化，好像没有了XenU的内核，而是改用了这种新的方式。</p>

<p>反正我用kernel启动失败了。后来用这个方式已经可以正常使用虚拟服务器了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS 5.3 安装虚拟化后的内存识别问题.]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/centos-xen-memory-problem/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/centos-xen-memory-problem</id>
    <content type="html"><![CDATA[<p>昨天单位到了2台SUN x4450.</p>

<p><strong>硬件配置相当强力.</strong></p>

<p>CPU 4颗6核的 Intel(R) Xeon(R) CPU           X7460 @ 2.66GHz</p>

<p>系统可以识别出24颗处理器</p>

<p><code>
[root@localhost ~]# cat /proc/cpuinfo |grep processor|wc -l
24
</code></p>

<p>内存64G</p>

<p>在内存问题上,我郁闷了一阵子.我用dmesg、free、top查看，都是32G</p>

<p>开始以为CentOS 5.3的64位内核就能支持到32G呢。又尝试在启动参数里加mem=64G</p>

<p>又上论坛询问、查看官方文档，都说CentOS 5.3 64bit应该没有内存限制的。</p>

<p>后来我发现了，原来问题出在安装的虚拟化上面</p>

<p>用xm top可以正确识别内存。而且安装的系统，只是当作xm 里面的一个dom0来运行的。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS 5.3下成功安装了Xen虚拟化服务。]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/centos-install-xen/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/centos-install-xen</id>
    <content type="html"><![CDATA[<p>今天参照下面文档成功安装了虚拟化服务。</p>

<p><a href="http://www.howtoforge.com/paravirtualization-with-xen-on-centos-5.3-x86_64-p2">http://www.howtoforge.com/paravirtualization-with-xen-on-centos-5.3-x86_64-p2</a></p>

<p>并且在虚拟化服务里，安装了一台vm01的虚拟Centos。</p>

<p>不过时间比较长，通过网络安装，用了4个小时。</p>
]]></content>
  </entry>
  
</feed>
