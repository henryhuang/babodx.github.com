<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Linux | 鑫的方向]]></title>
  <link href="http://babodx.github.com/blog/categories/linux/atom.xml" rel="self"/>
  <link href="http://babodx.github.com/"/>
  <updated>2013-02-27T08:21:06+08:00</updated>
  <id>http://babodx.github.com/</id>
  <author>
    <name><![CDATA[babodx]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ubuntu 8.10下同步wm6.1手机]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/winphone-SynceWithUbuntu/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/winphone-SynceWithUbuntu</id>
    <content type="html"><![CDATA[<p>参考了</p>

<ul>
<li><a href="http://www.synce.org/moin/SynceWithUbuntu">http://www.synce.org/moin/SynceWithUbuntu</a></li>
<li>http://hi.baidu.com/john_zhy/blog/item/50e39f317240141febc4af5a.html</li>
</ul>


<p>我的本本 IBM R61</p>

<p>系统 ubuntu 8.10从 8.04升级上来的。</p>

<p>手机 eten X800 wm6.1英文系统</p>

<p>原来一直不能在ubuntu下面同步手机资料，昨天参考了上面两个帖子，最后成功了。</p>

<p>1、首先添加源</p>

<p><code>
sudo gedit   /etc/apt/sources.list
</code></p>

<p>在末尾添加</p>

<p>```
deb <a href="http://ppa.launchpad.net/synce/ubuntu" target="_blank">http://ppa.launchpad.net/synce/ubuntu</a> hardy main</p>

<p>deb-src <a href="http://ppa.launchpad.net/synce/ubuntu" target="_blank">http://ppa.launchpad.net/synce/ubuntu</a> hardy main
```</p>

<p>保存，关闭</p>

<p><code>
sudo apt-get update
</code></p>

<p>我没有更新源，但是也成功。可能是8.10的缘故</p>

<p>2、更新usb驱动（仅内核在2.6.24-19之前的，如果比这个新请跳过本步骤）</p>

<p><code>
sudo rmmod rndis_host cdc_ether usbnet
sudo rm /lib/modules/`uname -r`/kernel/drivers/net/usb/{rndis_host,cdc_ether,usbnet}.ko
sudo apt-get install usb-rndis-source cdbs
sudo module-assistant auto-install usb-rndis
sudo apt-get install synce-hal librra0-tools librapi2-tools
</code></p>

<p>因为我的内核是2.6.27-7的，所以跳过了这步。但是我安装了后面的软件包</p>

<p><code>
sudo apt-get install synce-hal librra0-tools librapi2-tools
</code></p>

<p>3、安装<strong>SynCE-GNOME</strong></p>

<p><code>
sudo apt-get install python-setuptools
</code></p>

<p> 下载<a href="http://downloads.sourceforge.net/synce/synce-gnome-0.11.tar.gz">synce-gnome-0.11.tar.gz</a></p>

<p> 解压，在终端进入其目录，运行</p>

<p><code>
python setup.py build
sudo python setup.py install
</code></p>

<p>安装<strong>notification-daemon</strong>（如果没有安装过的话，用新得立软件包管理器搜索一下就可以了）</p>

<p>这个步骤完全做了一次，notification-daemon系统已经安装过了</p>

<p>4、连接好手机，运行</p>

<p><code>
/sbin/ifconfig -a | grep 80:00:60:0f:e8:00   | cut -d " " -f 1
</code></p>

<p>记下他输出的东西</p>

<p><code>
sudo gedit   /etc/network/interfaces
</code></p>

<p>在末尾添加<code>iface &lt;rndis0&gt; inet dhcp</code></p>

<p>ps:"&lt;>"里面的是我在上面那步里输出的，你应该更换成你自己的，不带“&lt;>“ 保存并关闭，然后运行</p>

<p><code>
sudo /etc/init.d/networking restart
</code></p>

<p>这次也是按照作的，我的网卡是多出来一个eth1(这个根据自己系统决定)。所以我在interfaces文件后面加入了</p>

<p><code>
iface eth1 inet dhcp
</code></p>

<p>5、安装OpenSync</p>

<p><code>
sudo apt-get install multisync-tools opensync-plugin-evolution opensync-plugin-synce
</code></p>

<p>6、现在该安装的都安装好了，就可以开始同步了<code>synce-sync-engine</code>如果出现如下错误</p>

<p>```
File "/usr/bin/sync-engine", line 84, in <module></p>

<p> configObj = Config.Config(progopts)</p>

<p>   File "/usr/lib/python2.5/site-packages/SyncEngine/config.py", line 292, in <strong>init</strong></p>

<p> oldconf = os.path.join(self.path,"config.xml")</p>

<p>AttributeError: Config instance has no attribute 'path'</p>

<p>```</p>

<p>请下载<a href="http://synce.svn.sf.net/svnroot/synce/releases/0.11.1/sync-engine/config/config.xml">config.xml</a>，保存为~/.synce/config.xml（提示："~"为自己的家目录)</p>

<p>创建同步项目<strong>synce-create-partnership "Linux desktop" "Contacts,Calendar"</strong></p>

<p>ps：还有别的，可自行选择Contacts， Calendar， Tasks， Files 等</p>

<p>创建OpenSync group</p>

<p>```
msynctool --addgroup synce-sync</p>

<p>msynctool --addmember synce-sync synce-opensync-plugin</p>

<p>msynctool --addmember synce-sync evo2-sync
```</p>

<p>然后同步synce-sync-engine</p>

<p><code>
msynctool --sync synce-sync
</code></p>

<p>他会同步到evolution里面</p>

<p>我上面的照着做，全部成功了。</p>

<p><strong>我的一些问题</strong></p>

<p>据说安装了synce-gnomevfs后，可以在Nautilus里面看手机里的内容，但是我没有成功
目前只能通过synce-pls、synce-pcp等命令，来操作手机里面文件。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[试用ubuntu 8.04和LVM动态增加分区]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/ubuntu-dynamic-resize-lvm/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/ubuntu-dynamic-resize-lvm</id>
    <content type="html"><![CDATA[<p>我在虚拟机VMware里面安装了ubuntu 8.04.</p>

<p>安装的时候，只是选择了openssh这个服务。安装后感觉系统很干净</p>

<p><strong>磁盘占用</strong>
<code>
/dev/mapper/ubuntu-root                      5.6G 321M 5.3G   6% /
</code></p>

<p>系统就用了不到400M</p>

<p><strong>内存</strong></p>

<p><code>
                   total       used       free     shared    buffers     cached
Mem:           249         39        209          0          3         16
</code>
减掉buffers和cached的内容，还有我ssh远程连接的占用。实际系统启动后内存也就需要17M</p>

<p><strong>LVM</strong></p>

<p>安装系统的时候，我就选择了整个磁盘启用LVM，采用ubuntu默认分区的方式。</p>

<p>ubuntu默认分了2个区/sda1和/sda5。sda1用来做/boot，sda5用来做LVM。文件系统都是默认的ext3。</p>

<p>然后在LVM里面默认建立了2个LV( Logical volume)，一个/dev/ubuntu/root用来做/ ，一个/dev/ubuntu/swap_1用来做swap交换分区。我又手动修改了文件系统，采用reiserfs。</p>

<p><strong>动态添加/分区大小</strong></p>

<p>我先添加了一个硬盘，系统识别为sdb</p>

<p>对这个盘<strong>创建分区</strong>（LVM可以不用分区的，但是需要动态添加到/分区，所以需要有文件系统，不能添加后格式化/分区吧）</p>

<p><code>
sudo fdisk /dev/sdb
n --&gt;创建分区
t --&gt;修改分区类型为8e
w --&gt;保存结果
</code></p>

<p>现在系统可以识别/dev/sdb1这个设备了。</p>

<p><strong>创建PV(Physical volume)</strong></p>

<p><code>
sudo pvcreate /dev/sdb1
</code></p>

<p><strong>创建VG(Volume group)</strong></p>

<p><code>
sudo vgextend ubuntu /dev/sdb1
</code></p>

<p><strong>扩展LV(Logical volume)</strong></p>

<p><code>
sudo lvextend -L +2G /dev/ubuntu/root&lt;br&gt;
</code></p>

<p>这样就给/dev/ubuntu/root这个设备大小增加了2G。可以通过sudo lvdisply查看
但是这个时候df -h还是没有变化的，需要调整文件系统。</p>

<p><code>
sudo resize_reiserfs -s +2G /dev/ubuntu/root&lt;br&gt;
</code></p>

<p>这样就完成了全部动态扩展分区。而且是服务器一直在线状态，不用关机。</p>

<p>调整Swap</p>

<p>还是和上面一样的情景，只要VG里面还有剩余空间就可以用来扩展swap用。</p>

<p><code>
sudo swapoff -a
</code></p>

<p>关闭正在用的swap分区</p>

<p>然后</p>

<p><code>
sudo lvextend -L +200M /dev/ubuntu/swap_1
</code></p>

<p>给/dev/ubuntu/swap_1扩展了200M容量</p>

<p><code>
sudo mkswap /dev/ubuntu/swap_1
</code></p>

<p>建立swap的文件系统</p>

<p>最后</p>

<p><code>
sudo swapon -a
</code></p>

<p>启用新的swap系统。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ubuntu 8.04升级到8.10]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/ubuntu-804-update-to-810/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/ubuntu-804-update-to-810</id>
    <content type="html"><![CDATA[<h1>升级</h1>

<p>昨天开始作的升级。</p>

<p>早上到单位，就开始<code>Alt+F2</code></p>

<p>在弹出的命令行窗口输入
<code>update-manager -d</code></p>

<p>然后就进入了漫长的等待，单位网络那个垃圾。。。。。告诉我42天。。。。。</p>

<p>一直到下班，下载了900多个文件，一共要下载1300多</p>

<p>晚上到家继续update-manager -d 发现居然可以接着下载，还以为要重新来呢。家里好点，告诉我3个小时,后来就睡觉了。</p>

<p>今天早上起来，发现已经下载完成了，开始到安装更新这一步了，弹出个窗口等我确认。</p>

<p>我点上开始，就洗漱去了。一直到要上班也没有安装完成。（TMD，居然忘记今天星期五，不能开车。还是老婆提醒我，才想起来。）这次我可不敢关机了，怕升级一半，下次进不来系统。直接把本本和上盖子放包里了，下楼打车上班。</p>

<p>在出租车里，完成了全部更新。关机。</p>

<p><strong>启动</strong></p>

<p>到了单位，发现系统总卡在进度条进不去。</p>

<p>按Alt+F1然后 Alt+F8查看下文字模式的启动信息，发现一直卡在*Configuring network interfaces...</p>

<p>这个第一次启动，没有办法（希望有好办法的，告诉下。）我就一直死等呀。。。感觉过了20分钟？？？</p>

<p>进入系统了，3D显卡驱动不行。运行uname -a查看，内核还在用8.04的2.6.24-21.</p>

<p>先修改网络吧
<code>sudo gedit /etc/network/interfaces</code></p>

<p>将里面的</p>

<p><code>
auto eth0
iface eth0 inet dhcp
auto lo
auto wlan0
</code></p>

<p>都注释掉，变成下面样子</p>

<p>```</p>

<h1>auto lo</h1>

<p>iface lo inet loopback</p>

<h1>iface eth0 inet dhcp</h1>

<p>address 10.11.10.164
netmask 255.255.255.0
gateway 10.11.10.254</p>

<h1>nameserver 202.106.0.20</h1>

<h1>auto eth0</h1>

<p>iface wlan0 inet dhcp
wpa-psk 7640768b3d6b31f834b63abc8d2d667ae10f8bc3c41a8e4e87ec2c104d963a1e
wpa-driver wext
wpa-key-mgmt WPA-PSK
wpa-proto WPA
wpa-ssid babohome</p>

<h1>auto wlan0</h1>

<p>```</p>

<p>接着修改/etc/NetworkManager/nm-system-settings.conf文件
<code>sudo gedit /etc/NetworkManager/nm-system-settings.conf</code></p>

<p>将文件里的<code>[ifupdown] manager=false</code>改成<code>[ifupdown] manager=true</code></p>

<p>这样基本启动速度的问题就正常</p>

<p><strong>内核</strong></p>

<p>再来说内核</p>

<p>内核需要手动编辑下grub的启动配置文件了。其实2.6.27-7内核已经安装了，就是没有给我们加入的menu.lst文件里面。修改menu.lst</p>

<p><code>sudo gedit /boot/grub/menu.lst</code></p>

<p>我的修改如下，这个应该每个人的不太一样。大家可以拷贝以前自己的文件进行修改</p>

<p><code>
title        Ubuntu 8.04.1, kernel 2.6.27-7-generic
root        (hd0,1)
kernel        /boot/vmlinuz-2.6.27-7-generic root=UUID=614a1c10-6ed3-45c9-b24d-f7b3e39725b2 ro quiet splash locale=zh_CN
initrd        /boot/initrd.img-2.6.27-7-generic
quiet
title        Ubuntu 8.04.1, kernel 2.6.27-7-generic (recovery mode)
root        (hd0,1)
kernel        /boot/vmlinuz-2.6.27-7-generic root=UUID=614a1c10-6ed3-45c9-b24d-f7b3e39725b2 ro single
initrd        /boot/initrd.img-2.6.27-7-generic
</code></p>

<p>这个修改后，先不要重新启动。因为我们还没有卸载显卡驱动，要不重启后，卸载驱动还要继续重启。</p>

<p><strong>卸载现有的显卡驱动</strong></p>

<p>我原来显卡驱动是用envyng -t来安装的，现在还用这个工具卸载</p>

<p>在终端<code>envyng -t</code></p>

<p>然后选卸载驱动，安后等卸载完成后，重启就ok了</p>

<p><strong>安装显卡驱动</strong></p>

<p>注意，如果内核还是2.6.24-21，新的驱动安装不上。</strong>这次我没有用envyng -t来安装，而是用系统->系统管理->硬件驱动来安装的</p>

<p>推荐我的是nvidia 177.80的驱动</p>

<p>等待安装完成后。 Ctrl+Alt+Backspace 重新启动X server</p>

<p>一切ok</p>

<p><strong>一些问题</strong>
在启动过程中，发现samba deamon启动fail还没有看是什么原因。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何快速统计服务器访问量]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/quick-stats-server-visits/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/quick-stats-server-visits</id>
    <content type="html"><![CDATA[<p>最近看了javaeye上面<strong>robbin</strong>的一篇文章，学习到了很多知识。</p>

<p><a href="http://robbin.javaeye.com/blog/97287">http://robbin.javaeye.com/blog/97287</a> 如何快速统计RoR网站的访问量</p>

<p>我的服务器是Apache+tomcat的配置，上面跑了几个网站。都是基于apache 虚拟主机配置的。</p>

<p>apache配置如下</p>

<p><code>
Include conf/vhost_*.conf
</code></p>

<p>然后每个虚拟主机对应一个配置文件</p>

<p>例如下面的(一些信息用???代替了，都是域名和姓名等个人信息)</p>

<p><code>
&lt;VirtualHost *:80&gt;
    ServerAdmin ???&lt;a href="mailto:???@???.cn"&gt;@???.cn&lt;/a&gt;
    DocumentRoot /home/???/www
    ServerName &lt;a href="http://www./???.org"&gt;www.???.org&lt;/a&gt;
    DirectoryIndex index.jsp index.htm
    ErrorLog logs/abc-error_log
    CustomLog "| /usr/sbin/rotatelogs /var/log/httpd/abc-access_%Y%m%d.log 86400" common
    &lt;Location "/*.jsp"&gt;
         JkUriSet worker ajp13:localhost:8009
    &lt;/Location&gt;
&lt;/VirtualHost&gt;
</code></p>

<p>这样配置后，就会在/var/log/httpd下面按照虚拟主机名字和日期，每天生成一个访问日志文件</p>

<p><strong>统计每日动态请求处理总数</strong></p>

<p><code>
cat /var/log/httpd/abc-access_20081116.log |grep "200 "|wc -l
</code></p>

<p><strong>统计URL的访问频度</strong></p>

<p><code>
cat /var/log/httpd/abc-access_20081116.log |grep "200 "|awk '{print $7}'|sort|uniq -c
</code></p>

<p><strong>统计时间访问频度</strong></p>

<p><code>
cat /var/log/httpd/abc-access_20081116.log |grep "200 "|awk '{print $4}'|awk -F : '{print $2}'|sort|uniq -c
</code></p>

<p><strong>以上这些是基于CentOS+apache+tomcat实现的</strong></p>

<p><code>
[root@ict ~]# cat /var/log/httpd/esdinchina-access_20081117.log |grep "200 "|awk '{print $4}'|awk -F : '{print $2}'|sort|uniq -c
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[安装和使用xen-shell]]></title>
    <link href="http://babodx.github.com/blog/2009/12/21/install-xen-shell/"/>
    <updated>2009-12-21T00:00:00+08:00</updated>
    <id>http://babodx.github.com/blog/2009/12/21/install-xen-shell</id>
    <content type="html"><![CDATA[<p>转自：<a href="http://www.xen-tools.org/software/xen-shell/install.html">http://www.xen-tools.org/software/xen-shell/install.html</a></p>

<p>Installing &amp; using the Xen-Shell</p>

<p>This shell makes several assumptions in the way that it operates:</p>

<ul>
<li>That you have a Xen 3.x host running.</li>
<li>Then Xen host has several guests running.</li>
<li>That you don't wish to give your users shell access on the host.</li>
</ul>


<p>If these assumptions are not valid for your environment then you might find that you have problems.</p>

<p><strong>Installation</strong></p>

<p>Download either <a href="http://www.xen-tools.org/releases.html">a release</a>, or a current version of <a href="http://www.xen-tools.org/cvs.html">the CVS repository</a> and install it by executing:</p>

<p><code>make install</code></p>

<p><strong>Configuring Users</strong></p>

<p>Each user is expected to login directly to the xen-shell, and not have any other access to the host system. To do this change their login shell by running:</p>

<p><code>chsh -s /usr/local/bin/xen-login-shell username</code></p>

<p>This will ensure when they connect to the system they will login to the shell, and run it within GNU Screen.</p>

<p><strong>Note:</strong>CVS and Debian binary packages use /usr/bin instead of /usr/local/.
Once you've changed the shell for the user you must update your Xen configuration files so that they include the username(s) of the users who can control them.
To allow the user "bob" and the user "steve" to control the Xen guest "builder.my.flat" you would add the following to /etc/xen/builder.my.flat.cfg:</p>

<p>```</p>

<h1>All instances must have a name name = 'builder.my.flat'    </h1>

<h1>These users may control this instance. xen_shell = 'bob, steve'</h1>

<p>```</p>

<p><strong>Bandwidth Accounting</strong></p>

<p>The shell allows the user to view the bandwidth they have transferred over a given period, using the bandwidth command.
For this to work the vnstat tool must be installed and configured upon dom0. It is assumed that each Xen guest will have their network interface named the same as the guest name.
For example a Xen guest called 'skx' will have a network interface 'skx' upon dom0. If you're using the standard Xen configuration setup you can achieve this by changing your skx.cfg file to read:</p>

<p><code>vif = [ 'vifname=skx,ip=1.2.3.4' ]</code></p>

<p><strong>Note:</strong> if you have more than one IP address allocated to a guest you will have to create a more complicated setup.</p>

<p><strong>Security</strong></p>

<p>Since the xen administrator command xm requires root privileges to run you will need to configure sudo to allow the users who are running your shell to execute that command, without being prompted for a password, as root.
Add something similar to the following to your /etc/sudoers file:</p>

<p><code>
User_Alias   XENUSERS = steve,bob,fred,foo
Cmnd_Alias   XEN      = /usr/sbin/xm
Cmnd_Alias   XENIMG   = /usr/bin/xen-create-image
XENUSERS     ALL      = NOPASSWD: XEN,XENIMG
</code></p>

<p><strong>Note:</strong>you only need to grant the ability to run xen-create-image if you wish to enable reimaging support in the shell.</p>

<p><strong>DNS Updates</strong></p>

<p>When the shell starts it will look for the file ips.txt in the home directory of the user who connects. If that file doesn't exist then the rdns command will be disabled.</p>

<p>If you wish to allow users to control their reverse DNS create that file and give it contents such as these:</p>

<p><code>192.168.1.1 foo.my.domain 192.168.1.2 bar.my.domain</code></p>

<p>This file will be updated by the user when they invoke the rdns command. It is up to you to read the files and create the corresponding zonefiles / DNS updates. The shell will only manipulate the file - not push DNS updates itself.</p>

<p><strong>Reimaging Support</strong></p>

<p>If a user connects to the shell and has the executable file image.sh in their home directory the reimage command will be enabled.
When the user invokes the command the image.sh script is executed after prompting for confirmation, and performing a last-chance count-down.
It is up to you to create and configure this script to do the right thing. A sample file for user bob could look like this:</p>

<p>```</p>

<h1>!/bin/sh /usr/bin/xen-create-image --hostname=bob \  </h1>

<p>--ip=192.168.1.1  \  
--ip=192.168.1.2 \  
--size=9.5G \  
--swap=512M  --mem=256M \  
--force
```</p>

<p>This will require a correctly configured instance of <a href="http://www.xen-tools.org/software/xen-tools/">xen-tools</a> and the sudoer file to contain the ability for the user to run xen-create-image.</p>

<p>Any remaining questions? <a href="http://www.xen-tools.org/contact/">contact the author</a></p>
]]></content>
  </entry>
  
</feed>
